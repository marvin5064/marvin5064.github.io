(window.webpackJsonp=window.webpackJsonp||[]).push([[2],{368:function(s,t,a){s.exports=a.p+"assets/img/functions-deployed.b5c965e6.png"},369:function(s,t,a){s.exports=a.p+"assets/img/create-user.424239f1.png"},370:function(s,t,a){s.exports=a.p+"assets/img/user-created-log.1cd3b4a3.png"},371:function(s,t,a){s.exports=a.p+"assets/img/user-data-created.c2b705d7.png"},372:function(s,t,a){s.exports=a.p+"assets/img/admin-verify-password.941e5ad0.png"},373:function(s,t,a){s.exports=a.p+"assets/img/admin-get-account-info.55c4c83e.png"},374:function(s,t,a){s.exports=a.p+"assets/img/update-user-data.ad804748.png"},375:function(s,t,a){s.exports=a.p+"assets/img/user-data-updated-log.4674f89d.png"},376:function(s,t,a){s.exports=a.p+"assets/img/non-admin-get-account-info.f4ddec21.png"},391:function(s,t,a){"use strict";a.r(t);var n=a(2),e=Object(n.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("h2",{attrs:{id:"what-is-firebase-functions"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#what-is-firebase-functions"}},[s._v("#")]),s._v(" What is "),n("a",{attrs:{href:"https://firebase.google.com/docs/functions",target:"_blank",rel:"noopener noreferrer"}},[s._v("Firebase functions"),n("OutboundLink")],1),s._v(" ?")]),s._v(" "),n("blockquote",[n("p",[s._v("Cloud Functions for Firebase let you automatically run backend code in response to events triggered by Firebase features and HTTPS requests. Your code is stored in Google's cloud and runs in a managed environment. There's no need to manage and scale your own servers.")])]),s._v(" "),n("p",[s._v("Maybe also take a look at what is "),n("a",{attrs:{href:"https://cloud.google.com/functions",target:"_blank",rel:"noopener noreferrer"}},[s._v("Cloud functions"),n("OutboundLink")],1),s._v(", which is so well-known as serverless. It is similar to "),n("a",{attrs:{href:"https://aws.amazon.com/lambda/",target:"_blank",rel:"noopener noreferrer"}},[s._v("AWS lambda"),n("OutboundLink")],1),s._v(" which more fit in google's cloud ecosystem, with feature pay per use. In some way, it is super cheap in terms of charge and maintenance if you put it in correct use.")]),s._v(" "),n("p",[s._v("In this article, we are going to look into few use cases to understand how firebase function could potentially work for us. It will mainly covers "),n("code",[s._v("Directly callable functions")]),s._v(" && "),n("code",[s._v("Trigger functions in Firebase ecosystem")])]),s._v(" "),n("h2",{attrs:{id:"setup-firebase"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#setup-firebase"}},[s._v("#")]),s._v(" Setup firebase")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" -g firebase-tools "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# install firebase tools")]),s._v("\n$ firebase login "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# login to firebase with your account")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# init a firebase function project")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# for now, I selectd Firestore & Functions, which will be used for next parts")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# also, I'm doing it on an existing project, as I ve done the firebase project setup from the UI")]),s._v("\n$ firebase init\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# generate file structure")]),s._v("\n$ tree\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\nâ”œâ”€â”€ firebase.json\nâ”œâ”€â”€ firestore.indexes.json\nâ”œâ”€â”€ firestore.rules\nâ””â”€â”€ functions\n    â”œâ”€â”€ node_modules\n    â”œ "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n    â”œâ”€â”€ package-lock.json\n    â”œâ”€â”€ package.json\n    â”œâ”€â”€ src\n    â”‚   â””â”€â”€ index.ts\n    â”œâ”€â”€ tsconfig.json\n    â””â”€â”€ tslint.json\n\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" directories, "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" files\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br")])]),n("p",[s._v("Since I choose to use typescript in this project, you can find "),n("a",{attrs:{href:"https://firebase.google.com/docs/functions/typescript",target:"_blank",rel:"noopener noreferrer"}},[s._v("all details here"),n("OutboundLink")],1),s._v(" about typescript for firebase functions.")]),s._v(" "),n("h2",{attrs:{id:"how-to-deploy-firebase-functions-and-trigger-them"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#how-to-deploy-firebase-functions-and-trigger-them"}},[s._v("#")]),s._v(" How to deploy firebase functions and trigger them")]),s._v(" "),n("h3",{attrs:{id:"directly-callable-functions"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#directly-callable-functions"}},[s._v("#")]),s._v(" Directly callable functions")]),s._v(" "),n("p",[s._v("There are mainly three types")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://firebase.google.com/docs/functions/callable",target:"_blank",rel:"noopener noreferrer"}},[s._v("Call functions from your app"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://firebase.google.com/docs/functions/http-events",target:"_blank",rel:"noopener noreferrer"}},[s._v("Call functions via HTTP requests"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://firebase.google.com/docs/functions/schedule-functions",target:"_blank",rel:"noopener noreferrer"}},[s._v("Schedule functions"),n("OutboundLink")],1),s._v(" "),n("ul",[n("li",[s._v("Pretty much link corn job on top of google PubSub")])])])]),s._v(" "),n("p",[s._v("I will more focus on HTTP request call, which we have an example below:")]),s._v(" "),n("p",[s._v("in the main file "),n("code",[s._v("./functions/src/index.ts")])]),s._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" functions "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'firebase-functions'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Start writing Firebase Functions")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// https://firebase.google.com/docs/functions/typescript")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" helloWorld "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" functions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("onRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Hello from Firebase!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("the "),n("code",[s._v("./functions/package.json")]),s._v(" already have couple of "),n("code",[s._v("scripts")])]),s._v(" "),n("div",{staticClass:"language-json line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-json"}},[n("code",[s._v("...\n  "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"scripts"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"lint"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tslint --project tsconfig.json"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"build"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"tsc"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"serve"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm run build && firebase serve --only functions"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"shell"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm run build && firebase functions:shell"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"start"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"npm run shell"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"deploy"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"firebase deploy --only functions"')]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token property"}},[s._v('"logs"')]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"firebase functions:log"')]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n...\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br")])]),n("p",[s._v("we can simply deploy the function as:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("yarn")]),s._v(" deploy\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\nâœ”  functions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("helloWorld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("us-central1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(": Successful create operation.\nFunction URL "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("helloWorld"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": https://us-central1-marvin-firebase.cloudfunctions.net/helloWorld\n\nâœ”  Deploy complete"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("\n\nProject Console: https://console.firebase.google.com/project/marvin-firebase/overview\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br")])]),n("p",[s._v("Hence the directly callable function "),n("code",[s._v("helloWorld")]),s._v(" has been deploy to the cloud!")]),s._v(" "),n("p",[s._v("details can be found in "),n("code",[s._v("https://console.firebase.google.com/project/marvin-firebase/overview")]),s._v(", also, I could be able to try out:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" -X GET https://us-central1-marvin-firebase.cloudfunctions.net/helloWorld\nHello from Firebase"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!")]),s._v("%\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("ðŸŽ‰ the direct calling functions works!")]),s._v(" "),n("h3",{attrs:{id:"trigger-functions-in-firebase-ecosystem"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#trigger-functions-in-firebase-ecosystem"}},[s._v("#")]),s._v(" Trigger functions in Firebase ecosystem")]),s._v(" "),n("p",[s._v("Firebase ecosystem here I meant: "),n("code",[s._v("Firestore")]),s._v(", "),n("code",[s._v("Database")]),s._v(", "),n("code",[s._v("Authentication")]),s._v(", "),n("code",[s._v("Analytics")]),s._v(", "),n("code",[s._v("Cloud Storage")]),s._v(" etc. You might want to "),n("a",{attrs:{href:"https://firebase.google.com/docs/functions/auth-events",target:"_blank",rel:"noopener noreferrer"}},[s._v("check details here for all details"),n("OutboundLink")],1),s._v(". In this section, I will cover "),n("code",[s._v("Firebase Authentication triggers")]),s._v(" and "),n("code",[s._v("Cloud Firestore triggers")]),s._v(".")]),s._v(" "),n("p",[s._v("Hence, to make it clear, I've break down file "),n("code",[s._v("./functions/src/index.ts")]),s._v(". And also created bunch of files for firebase triggers. You may find them below, under "),n("code",[s._v("./functions/src/")]),s._v(":")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ tree\n"),n("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v(".")]),s._v("\nâ”œâ”€â”€ auth.ts\nâ”œâ”€â”€ firestore.ts\nâ”œâ”€â”€ index.ts\nâ”œâ”€â”€ request.ts\nâ””â”€â”€ types.ts\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br")])]),n("p",[n("code",[s._v("types.ts")])]),s._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("interface")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Claims")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  isAdmin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("boolean")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  role"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("string")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("p",[n("code",[s._v("index.ts")])]),s._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" helloWorld "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./request'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" userUpdated "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./firestore'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" addDefaultUserRole "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./auth'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" admin "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'firebase-admin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" functions "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'firebase-functions'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// Start writing Firebase Functions")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// https://firebase.google.com/docs/functions/typescript")]),s._v("\n\nadmin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("initializeApp")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("functions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("config")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("firebase"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br")])]),n("p",[n("code",[s._v("request.ts")])]),s._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" functions "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'firebase-functions'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" helloWorld "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" functions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("https"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("onRequest")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("request"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  response"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("send")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'My first try on firebase for on request!'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br")])]),n("p",[s._v("I hope this file structure is easier to read, "),n("code",[s._v("auth.ts")]),s._v(" and "),n("code",[s._v("firestore.ts")]),s._v(" details will be listed below.")]),s._v(" "),n("p",[s._v("After this "),n("code",[s._v("yarn deploy")]),s._v(" will deploy firebase functions to the cloud.")]),s._v(" "),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"Functions deployed","data-src":a(368),loading:"lazy"}})]),s._v(" "),n("h4",{attrs:{id:"firebase-authentication-triggers"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#firebase-authentication-triggers"}},[s._v("#")]),s._v(" Firebase Authentication triggers")]),s._v(" "),n("p",[n("code",[s._v("auth.ts")])]),s._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" functions "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'firebase-functions'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" admin "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'firebase-admin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" addDefaultUserRole "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" functions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("auth"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("user")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("onCreate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("async")]),s._v(" user "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" uid "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("uid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//add custom claims")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" admin\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("auth")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setCustomUserClaims")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("uid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      isAdmin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      role"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("then")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" admin\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("firestore")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("doc")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'users/'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" user"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("uid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" isAdmin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br")])]),n("p",[s._v("Basically, this function is executed when "),n("code",[s._v("functions.auth.user().onCreate")]),s._v(", which will then assign a custom user claim "),n("code",[s._v("isAdmin")]),s._v(" and "),n("code",[s._v("role")]),s._v(" to the user. Also, "),n("code",[s._v("isAdmin")]),s._v(" will be stored in the firestore under path of "),n("code",[s._v("users/{uid}")]),s._v(" for given structure.")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("We can create a user as below\n"),n("img",{staticClass:"lazy",attrs:{alt:"Create user","data-src":a(369),loading:"lazy"}})])]),s._v(" "),n("li",[n("p",[s._v("Then we can see function "),n("code",[s._v("addDefaultUserRole")]),s._v(" has been executed properly from the log\n"),n("img",{staticClass:"lazy",attrs:{alt:"User created log","data-src":a(370),loading:"lazy"}})])]),s._v(" "),n("li",[n("p",[s._v("At the same time, database is also updated as expected.\n"),n("img",{staticClass:"lazy",attrs:{alt:"User data created","data-src":a(371),loading:"lazy"}})])]),s._v(" "),n("li",[n("p",[s._v("The claims should be in the token as well")])])]),s._v(" "),n("p",[s._v("I've build a simply frontend page for firebase auth, which I might share it as a blog in the future. Right now, we skip the details for it, only use it for checking the claims changed in the token.")]),s._v(" "),n("p",[s._v("Verify password:")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://www.googleapis.com/identitytoolkit/v3/relyingparty/verifyPassword?key=AIzaSyDXoTc8M3oTeoPnbveX2duU8KWcPDIeMEE'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:73.0) Gecko/20100101 Firefox/73.0'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Accept: */*'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Accept-Language: en-US,en;q=0.5'")]),s._v(" --compressed -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'X-Client-Version: Firefox/JsCore/7.8.1/FirebaseCore-web'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Origin: http://localhost:8080'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Connection: keep-alive'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Referer: http://localhost:8080/login'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TE: Trailers'")]),s._v(" --data "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"email":"marvin.test@gmail.com","password":"marvintest","returnSecureToken":true}\'')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"Admin verify password","data-src":a(372),loading:"lazy"}})]),s._v(" "),n("p",[s._v("Get account info")]),s._v(" "),n("div",{staticClass:"language-bash line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-bash"}},[n("code",[s._v("$ "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("curl")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'https://www.googleapis.com/identitytoolkit/v3/relyingparty/getAccountInfo?key=AIzaSyDXoTc8M3oTeoPnbveX2duU8KWcPDIeMEE'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10.14; rv:73.0) Gecko/20100101 Firefox/73.0'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Accept: */*'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Accept-Language: en-US,en;q=0.5'")]),s._v(" --compressed -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Content-Type: application/json'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'X-Client-Version: Firefox/JsCore/7.8.1/FirebaseCore-web'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Origin: http://localhost:8080'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Connection: keep-alive'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Referer: http://localhost:8080/login'")]),s._v(" -H "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'TE: Trailers'")]),s._v(" --data "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('\'{"idToken":"eyJhbGciOiJSUzI1NiIsImtpZCI6IjgyZTZiMWM5MjFmYTg2NzcwZjNkNTBjMTJjMTVkNmVhY2E4ZjBkMzUiLCJ0eXAiOiJKV1QifQ.eyJpc0FkbWluIjp0cnVlLCJyb2xlIjoiYWRtaW4iLCJpc3MiOiJodHRwczovL3NlY3VyZXRva2VuLmdvb2dsZS5jb20vbWFydmluLWZpcmViYXNlIiwiYXVkIjoibWFydmluLWZpcmViYXNlIiwiYXV0aF90aW1lIjoxNTg0NjI5MzM1LCJ1c2VyX2lkIjoiWVU3VndiaEYzRWhOQ25DOUx5OEVFTEtsMm1RMiIsInN1YiI6IllVN1Z3YmhGM0VoTkNuQzlMeThFRUxLbDJtUTIiLCJpYXQiOjE1ODQ2MjkzMzUsImV4cCI6MTU4NDYzMjkzNSwiZW1haWwiOiJtYXJ2aW4udGVzdEBnbWFpbC5jb20iLCJlbWFpbF92ZXJpZmllZCI6ZmFsc2UsImZpcmViYXNlIjp7ImlkZW50aXRpZXMiOnsiZW1haWwiOlsibWFydmluLnRlc3RAZ21haWwuY29tIl19LCJzaWduX2luX3Byb3ZpZGVyIjoicGFzc3dvcmQifX0.U-0zsDLwzEM_ypPp8lDevWBPF2jXsoe0wy_s0gysurG54gHEGycQlsa2rccBcZ4JmW8RHTQt3jj-SsgwryxMPB1g96rdjWMjv0TemfLwML0EGovMtm1sVYDn2P9c1O8gWrlAroB5wGXv0leRKEdRn2brFvMvRdpwV93ZZ6_tKI1_PuHaK0fq5_uzUNv2EH5s4EeKjSxUhfTSxkK5UinaRsKtl23ioH1htrhF4A00cBoZv4a7Bcvb_6n5fMtEjq8mZ_LX-C8LMAjP3khAqoz_0iUr9ufxKm95LLPVbWHZjbkb1zZRc99WvG5PQuVlmQUDyojlzbPzik8H9r5TmzaIwQ"}\'')]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("p",[n("img",{staticClass:"lazy",attrs:{alt:"Admin get account information","data-src":a(373),loading:"lazy"}})]),s._v(" "),n("p",[s._v("as you see, "),n("code",[s._v('"customAttributes": "{\\"isAdmin\\":true,\\"role\\":\\"admin\\"}",')]),s._v(" indicate the custom claims properly!")]),s._v(" "),n("h4",{attrs:{id:"cloud-firestore-triggers"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#cloud-firestore-triggers"}},[s._v("#")]),s._v(" Cloud Firestore triggers")]),s._v(" "),n("p",[n("code",[s._v("firestore.ts")])]),s._v(" "),n("div",{staticClass:"language-ts line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-ts"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" functions "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'firebase-functions'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" admin "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'firebase-admin'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v(" Claims "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("from")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'./types'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("export")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" userUpdated "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" functions"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("firestore\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("document")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'/users/{uid}'")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("onUpdate")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" data "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" handler"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("after"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("data")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" Claims"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("console")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("log")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'Data: '")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" admin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("auth")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("setCustomUserClaims")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("context"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("params"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("uid"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      isAdmin"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("isAdmin"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      role"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" data"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("isAdmin "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'admin'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'non-admin'")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])]),n("p",[s._v("This function will be executed when "),n("code",[s._v("functions.firestore.document('/users/{uid}').onUpdate")]),s._v(", which will then based on the after change data value assign different value to the auth custom claim.")]),s._v(" "),n("ol",[n("li",[n("p",[s._v("Get back to the data store, update the data as below:\n"),n("img",{staticClass:"lazy",attrs:{alt:"Update user data","data-src":a(374),loading:"lazy"}})])]),s._v(" "),n("li",[n("p",[s._v("Then we can found the function is triggered in the log:\n"),n("img",{staticClass:"lazy",attrs:{alt:"User data updated log","data-src":a(375),loading:"lazy"}})])]),s._v(" "),n("li",[n("p",[s._v("Again, we can check the customized claim is again, getting updated:")])])]),s._v(" "),n("p",[s._v("Here we do the same as above, we can see:\n"),n("img",{staticClass:"lazy",attrs:{alt:"Non-admin get account information","data-src":a(376),loading:"lazy"}})]),s._v(" "),n("p",[n("code",[s._v('"customAttributes": "{\\"isAdmin\\":false,\\"role\\":\\"non-admin\\"}",')]),s._v(" indicates the change of data triggers firebase functions which then updated the custom claims of the token.")]),s._v(" "),n("h2",{attrs:{id:"conclusion"}},[n("a",{staticClass:"header-anchor",attrs:{href:"#conclusion"}},[s._v("#")]),s._v(" Conclusion")]),s._v(" "),n("p",[s._v("As the examples shown above, firebase functions sit inside the firebase ecosystem, it can be triggered by simple HTTPs, firebase auth or simply an update of data in firestore. To some extend, you can take advantage of firebase to create a super convenient web / mobile application for your own purpose.")]),s._v(" "),n("p",[s._v("On their official website, there are other few sessions about:")]),s._v(" "),n("ul",[n("li",[n("a",{attrs:{href:"https://firebase.google.com/docs/functions/manage-functions",target:"_blank",rel:"noopener noreferrer"}},[s._v("deploy and config firebase functions"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://firebase.google.com/docs/functions/local-emulator",target:"_blank",rel:"noopener noreferrer"}},[s._v("testing firebase functions"),n("OutboundLink")],1)]),s._v(" "),n("li",[n("a",{attrs:{href:"https://firebase.google.com/docs/functions/writing-and-viewing-logs",target:"_blank",rel:"noopener noreferrer"}},[s._v("monitor firebase functions"),n("OutboundLink")],1)])]),s._v(" "),n("p",[s._v("They all worth to dive into details to master firebase. If you have time, worth to take a look ðŸŽ‰")])])}),[],!1,null,null,null);t.default=e.exports}}]);